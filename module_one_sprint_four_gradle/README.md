# Домашняя работа к третьему спринту курса Yandex Practicum
---
## Что внутри

- **REST-контроллер** `PostController` (`/api/posts`):
    - `GET /api/posts` — получить список сообщений
    - `GET /api/posts/{id}` — получить сообщение по ID
    - `POST /api/posts` — создать новое сообщение
    - `PUT /api/posts/{id}` — редактировать конкретное сообщение
    - `DELETE /api/posts/{id}` — удалить сообщение
    - `POST /api/posts/{id}/likes` — поставить лайк
    - `PUT /api/post/{id}/image` — загрузить изображение к сообщению
    - `GET /api/post/{id}/image` — скачать изображение к сообщению
    - `GET /api/post/undefined/comments` — обработчик мусорного обращения фронтэнда

- **REST-контроллер** `CommentController` (`/api/posts/{postid}/comments`):
    - `GET /api/posts/{postid}/comments` — получить список комментариев к сообщению postid
    - `GET /api/posts/{postid}/comments/{id}` — получить комментарий по ID (JSON)
    - `POST /api/posts/{postid}/comments` — создать новый комментарий к сообщению postid 
    - `PUT /api/posts/{postid}/comments/{id}` — редактировать конкретный комментарий
    - `DELETE /api/posts/{postid}/comments/{id}` — удалить комментарий

---
## Сборка проекта
  
 - `gradle clean build` - компилирует файлы, запускает тесты и генерирует в папке target файл .jar 
---
## Быстрый старт (только тесты)

- `gradle clean test`  - запускаем тесты
---
## Запуск приложения

- `gradle clean build bootRun` - запускаем приложение. Приложение поднимает вебсервер, и фронтэнд становится доступен по адресу 'http://localhost'  
---
## Требования к запуску

- `JDK21` - рабочая среда - JDK21, на более поздних версиях приложение не тестировалось
- Для корректного отображения данных в фронтэнде необходимо сохранить в корневой папке проекта директорию uploads. При необходимости ее можно перенести и переопределить в свойстве `images.path=uploads/` файла `application.properties`   


## Краткое описание
- Поскольку прежний опыт работы с JPA был неполный, а с JDBC работать приходилось, и много, была выбрана технология Java Spring Boot Data JPA
- В сравнении с домашней работой были переписаны классы-мапперы (package ru.yandex.practicum.mapping), изменились инструменты валидации (реализованы в PostController.class, CommentController.class). Валидация получилась односторонней, от контроллера к сущностям, полнота которых определена схемой
- С бинами поиграл в части настройки мапперов
- Достаточно много внимания пришлось уделить парсеру строки поискового запроса, а так инструментам поиска сообщений по заданным параметрам. Для реализации поиска по наличию **всех** присутствующих в запросе тэгов, пришлось пересмотреть решения задачи третьего спринта, скорее всего тот проект будет модифицирован    
---

## Что не удалось
- Не дошли руки реализовать миграции и применение полноценной базы данных
- Не реализовал возможности контейнеризации
- Работать над этим начну в рамках реализации нового проекта

## Изменения в сравнении с работой третьего спринта
- Учел замечание по именованию имен пакетов 
- По конкатенации SQL запросов, сейчас буду полностью переделывать поисковые запросы, с учетом результатов четвертой работы
- По валидации - произведены изменение в соответствии замечанием ревьюера 

## Что понравилось
- Spring Boot. Стартеры просто открывают новые возможности
- Data JPA, Data JDBC 
---

# Тестирование
## Unit - тесты
- `PostServiceTest` **_static Stream<Arguments> applySearchString()_** - Тестирует работу парсера поисковой строки 
## Интеграционные тесты
- `PostRepositoryTest` - Тестирует DAO слой в части работы с сущностями Post 
- `CommentRepositoryTest` - Тестирует DAO слой в части работы с сущностями Comment
- `PostControllerIntegrationTest` - Один из двух основных интерационных тестов, реализующий проверку основных сценариев взаимодействия с фронтэндом 
- `CommentControllerIntegrationTest` - Второй из двух основных интерационных тестов, реализующий проверку основных сценариев взаимодействия с фронтэндом
